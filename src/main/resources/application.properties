# ===========================================
# Development Configuration (H2 in-memory)
# ===========================================
quarkus.datasource.jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1
quarkus.datasource.db-kind=h2
quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.sql-load-script=import.sql

# ===========================================
# Production Configuration (PostgreSQL)
# ===========================================
%prod.quarkus.datasource.db-kind=postgresql
%prod.quarkus.datasource.jdbc.url=jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:inventory}
%prod.quarkus.datasource.username=${POSTGRES_USER:inventory}
%prod.quarkus.datasource.password=${POSTGRES_PASSWORD:inventory}
%prod.quarkus.datasource.jdbc.max-size=20
%prod.quarkus.datasource.jdbc.min-size=5
%prod.quarkus.hibernate-orm.database.generation=none
%prod.quarkus.hibernate-orm.sql-load-script=
%prod.quarkus.flyway.migrate-at-start=true
%prod.quarkus.package.uber-jar=true

# Flyway Configuration
quarkus.flyway.locations=db/migration
%dev.quarkus.flyway.migrate-at-start=false

# ===========================================
# Cache Configuration (Caffeine backend)
# ===========================================
quarkus.cache.caffeine.inventory-cache.expire-after-write=5m
quarkus.cache.caffeine.inventory-product-cache.expire-after-write=5m

# ===========================================
# Security - JWT Authentication
# ===========================================
# JWT configuration for production
%prod.mp.jwt.verify.publickey.location=${JWT_PUBLIC_KEY_URL:/publicKey.pem}
%prod.mp.jwt.verify.issuer=${JWT_ISSUER:https://your-issuer.com}
%prod.quarkus.smallrye-jwt.enabled=true

# Disable auth for development
%dev.quarkus.smallrye-jwt.enabled=false
%test.quarkus.smallrye-jwt.enabled=false

# Security roles mapping (production only)
%prod.quarkus.http.auth.permission.roles1.paths=/api/inventory/*
%prod.quarkus.http.auth.permission.roles1.policy=authenticated
# Allow health endpoints without authentication
quarkus.http.auth.permission.public.paths=/q/health/*,/q/health
quarkus.http.auth.permission.public.policy=permit

# Disable security for dev and test modes
%dev.quarkus.http.auth.permission.deny.paths=/*
%dev.quarkus.http.auth.permission.deny.policy=permit
%test.quarkus.http.auth.permission.deny.paths=/*
%test.quarkus.http.auth.permission.deny.policy=permit

# ===========================================
# Logging Configuration
# ===========================================
# Console logging format
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.level=INFO
quarkus.log.category."com.redhat.cloudnative".level=DEBUG

# JSON logging for production
%prod.quarkus.log.console.json=true
%prod.quarkus.log.console.json.pretty-print=false
%prod.quarkus.log.console.json.key-overrides=timestamp=@timestamp
%prod.quarkus.log.console.json.log-format=STRUCTURED

# Enable access logging
quarkus.http.access-log.enabled=true
%prod.quarkus.http.access-log.pattern=%h %l %u %t "%r" %s %b "%{i,Referer}" "%{i,User-Agent}"

# ===========================================
# Metrics Configuration (Micrometer/Prometheus)
# ===========================================
# Enable Prometheus metrics endpoint
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.binder-enabled-default=true
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.jvm.enabled=true

# Metrics endpoint path
quarkus.micrometer.export.prometheus.path=/q/metrics

# ===========================================
# Resilience Configuration (Fault Tolerance)
# ===========================================
# Enable fault tolerance
quarkus.fault-tolerance.enabled=true

# Default timeout settings
Timeout/enabled=true
Timeout/value=5000

# Circuit breaker defaults
CircuitBreaker/enabled=true
CircuitBreaker/failure-ratio=0.5
CircuitBreaker/request-volume-threshold=10
CircuitBreaker/delay=5000
CircuitBreaker/success-threshold=3

# Retry defaults
Retry/enabled=true
Retry/max-retries=3
Retry/delay=100
